<%@ taglib prefix="s" uri="/struts-tags"%><s:url action="ajSearchMenu" namespace="/search" id="ajSearchMenuURL"/><s:url action="saveUserMenu" namespace="/permission" id="saveUserMenuURL"/><style>select.multiple {width:265px;height:300px;}#msg p {  padding: 3px;}</style><div id="msg" style="margin-bottom: 5px;"></div><div>	<select id="root_menu">		<option value="">---All Menu--</option>		<s:iterator value="rootmenus">			<option value='<s:property value="id" />'><s:property value="name" /></option>											</s:iterator>	</select></div><div><div style="float:left;"><select class="multiple" multiple id="select1">  </select></div><div style="float: left; height: 300px; width: 50px; padding-left: 5px;"><button id="btadd"><span class="ui-icon ui-icon-seek-end"></button><br><button id="btremove"><span class="ui-icon ui-icon-seek-first"></button><br><button id="btaddall"><span class="ui-icon ui-icon-seek-next"></button><br><button id="btremoveall"><span class="ui-icon ui-icon-seek-prev"></button><br></div><div style="float:left;"><form id="dialogForm"><input type="hidden" name="username" value="<s:property value="accountExt.username"/>"/><select class="multiple" multiple name="idmenus" id="select2">  <s:iterator value="user_menus">	<option value='<s:property value="value" />'><s:property value="label" /></option>									</s:iterator></select></form></div></div><div style="width: 100%; padding: 5px; margin-top: 10px; float: left;">	<center><button id="btSavePermission">Lưu</button></center></div><script>function message(msg,type) {	if(msg == '') { // clear		$("#dialog #msg").empty();		return;	}	if(type==1) { //Thong diep thong bao		$("#dialog #msg").html('<div class="ui-state-highlight ui-corner-all" style=" padding: 0 .7em;"><p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span><strong>Success : </strong> '+msg+'</p></div>');	} else if(type == 0) { //Thong diep bao loi		$("#dialog #msg").html('<div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"><p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><strong>Error : </strong> '+msg+'</p></div>');	}}function loadMenuByRoot(root_menu) {	block("#dialog");	$.ajax({		type: "GET",		cache: false,		url : "${ajSearchMenuURL}",		data : "root_menu="+root_menu,		success: function(data){			unblock("#dialog");			var select1 = $("#select1");			select1.html('');			$.each(data.data, function() {				if($("#select2 option[value="+this.id+"]").length == 0)					select1.append('<option value="'+this.id+'">'+this.namemenu+'</option>');				else					select1.append('<option disabled=true value="'+this.id+'">'+this.namemenu+'</option>');			});		},		error: function(data){ alert (data);unblock("#dialog");}		});}$(document).ready(function(){	$("#dialog").dialog("option", "position", "center");	$("#dialog").dialog('option', 'title', 'Phân quyền cho user : <s:property value="accountExt.honhanvien"/> <s:property value="accountExt.tennhanvien"/>');	/* $('button').button({		disabled: null,	}); */	MultiSelect("btadd","btremove","btaddall","btremoveall","select1","select2");	$("#btSavePermission").click(function(){		_this = this;		_this.disabled = true;		message('');		$("#select2").each(function(){  			$("#select2 option").attr("selected","selected");		});		var dataString = $("#dialogForm").serialize();		$.ajax({			type: "GET",			cache: false,			url : "${saveUserMenuURL}",			data : dataString,			success: function(data){				if(data == "END_SESSION") {					location.href = LOGIN_PATH;					return;				}				_this.disabled = false;				if(data == 'ERROR') {					message('Có lỗi xảy ra, vui lòng thử lại!',0);					return;				}				if(data == 'OK') {					message('Lưu thành công!',1);					return;				}			},			error: function(data){ alert (data);_this.disabled = false;}			});	}); 	loadMenuByRoot(0);	$("#root_menu").change(function(){		message('');		loadMenuByRoot(this.value);	});});</script>